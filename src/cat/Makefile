#
#   Если хочешь знать, как это работает, загляни в
#       https://habr.com/ru/post/155201/.
#   Если этого мало, отведай https://stackoverflow.com/questions/2734719/
#       how-to-compile-a-static-library-in-linux
#

CC=gcc
CFLAGS=-Wall -Wextra -Werror -D DEBUG_
LDFLAGS=
GREP_SOURCES=$(wildcard ./s21_*.c)
GREP_OBJECTS=$(GREP_SOURCES:.c=.o)
GREP_EXE=./s21_grep
CAT_SOURCES=$(wildcard ./s21_*.c)
CAT_OBJECTS=$(CAT_SOURCES:.c=.o)
CAT_EXE=./s21_cat
CPPLINT_CFG=../../materials/linters/CPPLINT.cfg
CPPLINT=../../materials/linters/cpplint.py

##TEST_SOURCES=./test.c
##CLIBS=-lm $(shell pkg-config --cflags --libs check)


all: s21_grep s21_cat cpplint


%.o: %.c ./grep/s21_grep.h
	$(CC) -c $(CFLAGS) $< -o $@


$(GREP_EXE): $(GREP_OBJECTS)
	clear
	$(CC) $^ -o $@


$(CAT_EXE): $(CAT_OBJECTS)
	clear
	$(CC) $^ -o $@


s21_grep: $(GREP_EXE)


s21_cat: $(CAT_EXE)


s21_grep_test: s21_grep
	########################################################RIGHT:
	   grep     "reg....()" ./sometext.txt; exit 0
	#########################################################MINE:
	$(GREP_EXE) "reg....()" ./sometext.txt; exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	echo "hello\nYES\nyes\nheYlo\nyye\nHEILO" \
        |    grep     -i -e he.lo
	#########################################################MINE:
	echo "hello\nYES\nyes\nheYlo\nyye\nHEILO" \
        | $(GREP_EXE) -i -e he.lo
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	echo "yes" |    grep     -i E
	#########################################################MINE:
	echo "yes" | $(GREP_EXE) -i E
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -v -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -v -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -c "reg....()" ./sometext.txt
	#########################################################MINE:
	$(GREP_EXE) -c "reg....()" ./sometext.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -l -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -l -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -n -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -n -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -h "reg....()" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -h "reg....()" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -s "reg....()" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -s "reg....()" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -s "reg....()" ./sometext.txt ./blabla; exit 0
	#########################################################MINE:
	$(GREP_EXE) -s "reg....()" ./sometext.txt ./blabla
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -f patterns.txt ./grep/s21_main.c ./sometext1.txt; exit 0
	#########################################################MINE:
	$(GREP_EXE) -f patterns.txt ./grep/s21_main.c ./sometext1.txt; exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -o "reg....()" ./sometext.txt
	#########################################################MINE:
	$(GREP_EXE) -o "reg....()" ./sometext.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     "o" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) "o" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     "y" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) "y" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -e "y" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -e "y" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -i -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -i -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -n -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(GREP_EXE) -n -e "reg....()" -e "form" ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -e "reg()" -e "frm" ./sometext.txt ./sometext4.txt; exit 0
	#########################################################MINE:
	$(GREP_EXE) -e "reg()" -e "frm" ./sometext.txt ./sometext4.txt; exit 0



s21_cat_test: clean $(CAT_EXE)
	########################################################RIGHT:
	       cat -te ./sometext_with_spaces.txt
	#########################################################MINE:
	$(CAT_EXE) -te ./sometext_with_spaces.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -en ./sometext.txt ./sometext1.txt; exit 0
	#########################################################MINE:
	$(CAT_EXE) -en ./sometext.txt ./sometext1.txt; exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -b ./sometext.txt ./sometext_with_spaces.txt \
            > cat.out; exit 0
	#########################################################MINE:
	$(CAT_EXE) --number-nonblank ./sometext.txt ./sometext_with_spaces.txt \
            > s21_cat.out; exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -n ./sometext.txt ./sometext1.txt
	#########################################################MINE:
	$(CAT_EXE) --number ./sometext.txt ./sometext1.txt
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -s ./sometext.txt ./sometext_with_spaces.txt; exit 0
	#########################################################MINE:
	$(CAT_EXE) --squeeze-blank ./sometext.txt ./sometext_with_spaces.txt; \
        exit 0
	######################################################################
	######################################################################
	######################################################################
	bash ./t_cat.sh


clean:
	find . \( -iname "*.gcda" \
		-or -iname "*.gcov" \
		-or -iname "*.gcno" \
		-or -iname "*.out" \
		-or -iname "*.o" \
		-or -iname "*.a" \
		-or -iname "*.html" \
		-or -iname "*.info" \
		-or -iname "*.css" \
		-or -iname "*.png" \
	\) -exec mv {} /tmp/ ; exit 0

	mv $(GREP_EXE) /tmp/; exit 0
	mv $(CAT_EXE) /tmp/; exit 0
	mv $(GREP_OBJECTS) /tmp/; exit 0
	mv $(CAT_OBJECTS) /tmp/; exit 0


cpplint:
	cp $(CPPLINT_CFG) ./
	python3 $(CPPLINT) --extensions=c \
        $(GREP_SOURCES) $(CAT_SOURCES)


valgrind: $(GREP_EXE) $(CAT_EXE)
	valgrind \
		-s \
		--track-origins=yes \
		--show-leak-kinds=all \
		$(GREP_EXE); exit 0;
	valgrind \
		-s \
		--track-origins=yes \
		--show-leak-kinds=all \
		$(CAT_EXE); exit 0;


cppcheck:
	cppcheck --enable=all --suppress=missingIncludeSystem $(SOURCES)

