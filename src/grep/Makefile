#
#   Если хочешь знать, как это работает, загляни в
#       https://habr.com/ru/post/155201/.
#   Если этого мало, отведай https://stackoverflow.com/questions/2734719/
#       how-to-compile-a-static-library-in-linux
#

CC=gcc
CFLAGS=-Wall -Wextra -Werror -D DEBUG_
LDFLAGS=
GREP_SOURCES=$(wildcard ./s21_*.c)
GREP_OBJECTS=$(GREP_SOURCES:.c=.o)
GREP_EXE=./s21_grep
CAT_SOURCES=$(wildcard ./s21_*.c)
CAT_OBJECTS=$(CAT_SOURCES:.c=.o)
CAT_EXE=./s21_cat
CPPLINT_CFG=../../materials/linters/CPPLINT.cfg
CPPLINT=../../materials/linters/cpplint.py
TEST_FILE_1=../common/sometext.txt
TEXT_FILE_2=../common/sometext_with_spaces.txt
TEXT_FILE_3=../common/sometext1.txt

##TEST_SOURCES=./test.c
##CLIBS=-lm $(shell pkg-config --cflags --libs check)


all: s21_grep s21_cat cpplint


%.o: %.c ./grep/s21_grep.h
	$(CC) -c $(CFLAGS) $< -o $@


$(GREP_EXE): $(GREP_OBJECTS)
	clear
	$(CC) $^ -o $@


$(CAT_EXE): $(CAT_OBJECTS)
	clear
	$(CC) $^ -o $@


s21_grep: $(GREP_EXE)


s21_cat: $(CAT_EXE)


s21_grep_test: s21_grep
	########################################################RIGHT:
	   grep     "reg....()" $(TEST_FILE_1); exit 0
	#########################################################MINE:
	$(GREP_EXE) "reg....()" $(TEST_FILE_1); exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	echo "hello\nYES\nyes\nheYlo\nyye\nHEILO" \
        |    grep     -i -e he.lo
	#########################################################MINE:
	echo "hello\nYES\nyes\nheYlo\nyye\nHEILO" \
        | $(GREP_EXE) -i -e he.lo
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	echo "yes" |    grep     -i E
	#########################################################MINE:
	echo "yes" | $(GREP_EXE) -i E
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -v -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -v -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -c "reg....()" $(TEST_FILE_1)
	#########################################################MINE:
	$(GREP_EXE) -c "reg....()" $(TEST_FILE_1)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -l -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -l -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -n -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -n -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -h "reg....()" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -h "reg....()" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -s "reg....()" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -s "reg....()" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -s "reg....()" $(TEST_FILE_1) ./blabla; exit 0
	#########################################################MINE:
	$(GREP_EXE) -s "reg....()" $(TEST_FILE_1) ./blabla
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -f patterns.txt ./grep/s21_main.c $(TEXT_FILE_3); exit 0
	#########################################################MINE:
	$(GREP_EXE) -f patterns.txt ./grep/s21_main.c $(TEXT_FILE_3); exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -o "reg....()" $(TEST_FILE_1)
	#########################################################MINE:
	$(GREP_EXE) -o "reg....()" $(TEST_FILE_1)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     "o" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) "o" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     "y" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) "y" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -e "y" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -e "y" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -i -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -i -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -n -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(GREP_EXE) -n -e "reg....()" -e "form" $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	   grep     -e "reg()" -e "frm" $(TEST_FILE_1) ./sometext4.txt; exit 0
	#########################################################MINE:
	$(GREP_EXE) -e "reg()" -e "frm" $(TEST_FILE_1) ./sometext4.txt; exit 0



s21_cat_test: clean $(CAT_EXE)
	########################################################RIGHT:
	       cat -te $(TEXT_FILE_2)
	#########################################################MINE:
	$(CAT_EXE) -te $(TEXT_FILE_2)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -en $(TEST_FILE_1) $(TEXT_FILE_3); exit 0
	#########################################################MINE:
	$(CAT_EXE) -en $(TEST_FILE_1) $(TEXT_FILE_3); exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -b $(TEST_FILE_1) $(TEXT_FILE_2) \
            > cat.out; exit 0
	#########################################################MINE:
	$(CAT_EXE) --number-nonblank $(TEST_FILE_1) $(TEXT_FILE_2) \
            > s21_cat.out; exit 0
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -n $(TEST_FILE_1) $(TEXT_FILE_3)
	#########################################################MINE:
	$(CAT_EXE) --number $(TEST_FILE_1) $(TEXT_FILE_3)
	######################################################################
	######################################################################
	######################################################################
	########################################################RIGHT:
	       cat -s $(TEST_FILE_1) $(TEXT_FILE_2); exit 0
	#########################################################MINE:
	$(CAT_EXE) --squeeze-blank $(TEST_FILE_1) $(TEXT_FILE_2); \
        exit 0
	######################################################################
	######################################################################
	######################################################################
	bash ./t_cat.sh


clean:
	find . \( -iname "*.gcda" \
		-or -iname "*.gcov" \
		-or -iname "*.gcno" \
		-or -iname "*.out" \
		-or -iname "*.o" \
		-or -iname "*.a" \
		-or -iname "*.html" \
		-or -iname "*.info" \
		-or -iname "*.css" \
		-or -iname "*.png" \
	\) -exec mv {} /tmp/ ; exit 0

	mv $(GREP_EXE) /tmp/; exit 0
	mv $(CAT_EXE) /tmp/; exit 0
	mv $(GREP_OBJECTS) /tmp/; exit 0
	mv $(CAT_OBJECTS) /tmp/; exit 0


cpplint:
	cp $(CPPLINT_CFG) ./
	python3 $(CPPLINT) --extensions=c \
        $(GREP_SOURCES) $(CAT_SOURCES)


valgrind: $(GREP_EXE) $(CAT_EXE)
	valgrind \
		-s \
		--track-origins=yes \
		--show-leak-kinds=all \
		$(GREP_EXE); exit 0;
	valgrind \
		-s \
		--track-origins=yes \
		--show-leak-kinds=all \
		$(CAT_EXE); exit 0;


cppcheck:
	cppcheck --enable=all --suppress=missingIncludeSystem $(SOURCES)

